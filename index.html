<!DOCTYPE html>
<html>
<head>
    <title>Chat App saar</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: flex; flex-direction: column; height: 98vh; margin: 0; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; }
        .msg { background: #2e2e2e; padding: 10px; border-radius: 8px; margin-bottom: 8px; width: fit-content; max-width: 80%; }
        .input-area { padding: 20px; display: flex; gap: 10px; background: #1e1e1e; }
        input { flex: 1; padding: 12px; border-radius: 5px; border: none; background: #333; color: white; }
        button { padding: 10px 20px; background: #3ecf8e; border: none; color: black; font-weight: bold; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>

    <div id="chat"></div>
    <div class="input-area">
        <input type="text" id="mInput" placeholder="Type a message...">
        <button onclick="send()">Send</button>
    </div>

    <script>
        const S_URL = 'https://dttishhuuaxerqpshszk.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0dGlzaGh1dWF4ZXJxcHNoc3prIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MjcwNjAsImV4cCI6MjA4NzEwMzA2MH0.09_sMIPfcCT0VtdC_-L99vd_DmO7ZIBnRLr9-OhLU_0';
        const supabaseClient = supabase.createClient(S_URL, S_KEY);

        const chat = document.getElementById('chat');
        const mInput = document.getElementById('mInput');

        async function load() {
            const { data } = await supabaseClient.from('messages').select('*').order('created_at', { ascending: true });
            if (data) chat.innerHTML = data.map(m => `<div class="msg">${m.content}</div>`).join('');
            chat.scrollTop = chat.scrollHeight;
        }

        async function send() {
            const val = mInput.value;
            if (!val) return;
            await supabaseClient.from('messages').insert([{ content: val }]);
            mInput.value = '';
        }

        supabaseClient.channel('messages').on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
            chat.innerHTML += `<div class="msg">${payload.new.content}</div>`;
            chat.scrollTop = chat.scrollHeight;
        }).subscribe();

        load();

        mInput.addEventListener("keypress", (e) => { if (e.key === "Enter") send(); });
    </script>
</body>
</html>
